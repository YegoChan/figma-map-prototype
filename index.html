<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¶©ë‚¨ëŒ€í•™êµ ìº í¼ìŠ¤ ì§€ë„</title>
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=46de823e6fff11047613229fe0d8049f"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body, html {
            width: 100%;
            height: 100%;
            overflow: hidden;
        }
        #map {
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body>
    <div id="map"></div>

    <script>
        console.log('ìŠ¤í¬ë¦½íŠ¸ ì‹œì‘');
        
        // ì œë³´ ë°ì´í„° - ì¶©ë‚¨ëŒ€í•™êµ ì¤‘ì‹¬(36.3684, 127.3448) ê·¼ì²˜ì— ë¶„ì‚° ë°°ì¹˜
        const reports = [
            {
                id: '1',
                title: 'ê³µê³¼ëŒ€í•™ 1ì¸µ í™”ì¥ì‹¤ ìˆ˜ë„ ê³ ì¥',
                location: 'ê³µê³¼ëŒ€í•™ 1ì¸µ',
                likes: 67,
                commentCount: 2,
                lat: 36.3700,
                lng: 127.3480,
                status: 'resolved'
            },
            {
                id: '2',
                title: 'ì¤‘ì•™ë„ì„œê´€ ì—ì–´ì»¨ ê³ ì¥',
                location: 'ì¤‘ì•™ë„ì„œê´€ 3ì¸µ',
                likes: 89,
                commentCount: 1,
                lat: 36.3705,
                lng: 127.3445,
                status: 'in_progress'
            },
            {
                id: '3',
                title: 'í•™ìƒíšŒê´€ ì‹ë‹¹ ìœ„ìƒ ë¬¸ì œ',
                location: 'í•™ìƒíšŒê´€ 2ì¸µ ì‹ë‹¹',
                likes: 52,
                commentCount: 0,
                lat: 36.3670,
                lng: 127.3430,
                status: 'received'
            },
            {
                id: '4',
                title: 'ì •ì‹¬í™”ê´€ ì—˜ë¦¬ë² ì´í„° ê³ ì¥',
                location: 'ì •ì‹¬í™”ê´€',
                likes: 45,
                commentCount: 1,
                lat: 36.3695,
                lng: 127.3425,
                status: 'resolved'
            },
            {
                id: '5',
                title: 'ìì—°ëŒ€ ê°•ì˜ì‹¤ ë¹”í”„ë¡œì í„° ë¶ˆëŸ‰',
                location: 'ìì—°ëŒ€ 305í˜¸',
                likes: 28,
                commentCount: 0,
                lat: 36.3675,
                lng: 127.3465,
                status: 'inconvenient'
            },
            {
                id: '6',
                title: 'ê¸°ìˆ™ì‚¬ ìƒ¤ì›Œì‹¤ ì˜¨ìˆ˜ ì•ˆ ë‚˜ì˜´',
                location: 'ê¸°ìˆ™ì‚¬ 3ë™',
                likes: 73,
                commentCount: 1,
                lat: 36.3710,
                lng: 127.3490,
                status: 'in_progress'
            },
            {
                id: '7',
                title: 'ìƒí™œê³¼í•™ëŒ€ ë³µë„ ì¡°ëª… ì–´ë‘ì›€',
                location: 'ìƒí™œê³¼í•™ëŒ€ 4ì¸µ',
                likes: 36,
                commentCount: 1,
                lat: 36.3680,
                lng: 127.3455,
                status: 'resolved'
            },
            {
                id: '8',
                title: 'ì¤‘ì•™ê´‘ì¥ ë²¤ì¹˜ í˜ì¸íŠ¸ ë²—ê²¨ì§',
                location: 'ì¤‘ì•™ê´‘ì¥',
                likes: 19,
                commentCount: 0,
                lat: 36.3684,
                lng: 127.3448,
                status: 'inconvenient'
            }
        ];

        // ìƒíƒœ ë ˆì´ë¸”
        const statusLabels = {
            'inconvenient': 'ë¶ˆí¸í•´ìš”',
            'received': 'ë¬¸ì œ ì ‘ìˆ˜',
            'in_progress': 'í•´ê²° ì¤‘',
            'resolved': 'í•´ê²° ì™„ë£Œ'
        };

        const statusColors = {
            'inconvenient': '#fee2e2',
            'received': '#dbeafe',
            'in_progress': '#fef3c7',
            'resolved': '#dcfce7'
        };

        const statusTextColors = {
            'inconvenient': '#991b1b',
            'received': '#1e40af',
            'in_progress': '#854d0e',
            'resolved': '#166534'
        };

        // ê³µê°ìˆ˜ì— ë”°ë¥¸ ìƒ‰ìƒ
        function getMarkerColor(likes) {
            if (likes >= 50) return 'red';
            if (likes >= 20) return 'orange';
            return 'green';
        }

        // SVGë¥¼ Data URLë¡œ ë³€í™˜
        function createMarkerImage(color, size) {
            const svgColor = color === 'red' ? '#ef4444' : color === 'orange' ? '#f97316' : '#22c55e';
            const svg = `
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="${size}" height="${size}">
                    <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z" fill="${svgColor}" stroke="white" stroke-width="2"/>
                    <circle cx="12" cy="10" r="3" fill="white"/>
                </svg>
            `;
            const encoded = encodeURIComponent(svg);
            return `data:image/svg+xml,${encoded}`;
        }

        // ì§€ë„ ìƒì„±
        window.onload = function() {
            console.log('window.onload ì‹¤í–‰');
            console.log('kakao ê°ì²´:', typeof kakao !== 'undefined' ? 'ìˆìŒ' : 'ì—†ìŒ');
            
            if (typeof kakao === 'undefined' || !kakao.maps) {
                console.error('ì¹´ì¹´ì˜¤ë§µ APIê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤');
                return;
            }

            const container = document.getElementById('map');
            // ì¶©ë‚¨ëŒ€í•™êµ ì¤‘ì‹¬ ì¢Œí‘œ (ë³¸ê´€/ì¤‘ì•™ê´‘ì¥ ê¸°ì¤€)
            const cnuCenter = new kakao.maps.LatLng(36.3684, 127.3448);
            
            const options = {
                center: cnuCenter,
                level: 4  // ì¶©ë‚¨ëŒ€ ì „ì²´ê°€ ë³´ì´ëŠ” ì ì ˆí•œ ì¤Œ ë ˆë²¨
            };
            
            const map = new kakao.maps.Map(container, options);
            console.log('ì§€ë„ ìƒì„± ì™„ë£Œ - ì¶©ë‚¨ëŒ€ ì¤‘ì‹¬ìœ¼ë¡œ ì„¤ì •');
            
            // ì»¨íŠ¸ë¡¤ ì¶”ê°€
            const mapTypeControl = new kakao.maps.MapTypeControl();
            map.addControl(mapTypeControl, kakao.maps.ControlPosition.TOPRIGHT);
            
            const zoomControl = new kakao.maps.ZoomControl();
            map.addControl(zoomControl, kakao.maps.ControlPosition.RIGHT);
            
            // ë§ˆì»¤ ìƒì„±
            console.log('ë§ˆì»¤ ìƒì„± ì‹œì‘, ì œë³´ ê°œìˆ˜:', reports.length);
            
            reports.forEach((report, index) => {
                const position = new kakao.maps.LatLng(report.lat, report.lng);
                
                console.log(`ë§ˆì»¤ ${index + 1}: ${report.title} (${report.lat}, ${report.lng})`);
                
                const color = getMarkerColor(report.likes);
                const size = report.likes >= 50 ? 50 : report.likes >= 20 ? 42 : 36;
                
                // ë§ˆì»¤ ì´ë¯¸ì§€ ìƒì„±
                const imageSrc = createMarkerImage(color, size);
                const imageSize = new kakao.maps.Size(size, size);
                const imageOption = { offset: new kakao.maps.Point(size / 2, size) };
                const markerImage = new kakao.maps.MarkerImage(imageSrc, imageSize, imageOption);
                
                // ë§ˆì»¤ ìƒì„±
                const marker = new kakao.maps.Marker({
                    position: position,
                    image: markerImage,
                    map: map
                });
                
                console.log(`ë§ˆì»¤ ${index + 1} ìƒì„± ì™„ë£Œ`);
                
                // ì¸í¬ìœˆë„ìš° ë‚´ìš©
                const infoContent = `
                    <div style="padding: 12px; min-width: 200px; background: white; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;">
                        <div style="font-weight: 600; font-size: 14px; margin-bottom: 6px; color: #1a1a1a;">${report.title}</div>
                        <div style="font-size: 12px; color: #666; margin-bottom: 8px;">${report.location}</div>
                        <div style="display: flex; gap: 12px; font-size: 12px; color: #888; margin-bottom: 6px;">
                            <span>â¤ï¸ ${report.likes}</span>
                            <span>ğŸ’¬ ${report.commentCount}</span>
                        </div>
                        <div style="display: inline-block; padding: 3px 10px; border-radius: 4px; font-size: 11px; background: ${statusColors[report.status]}; color: ${statusTextColors[report.status]};">
                            ${statusLabels[report.status]}
                        </div>
                    </div>
                `;
                
                const infowindow = new kakao.maps.InfoWindow({
                    content: infoContent,
                    removable: false
                });
                
                // í´ë¦­ ì´ë²¤íŠ¸
                kakao.maps.event.addListener(marker, 'click', function() {
                    infowindow.open(map, marker);
                });
                
                // ë§ˆìš°ìŠ¤ì˜¤ë²„ ì´ë²¤íŠ¸
                kakao.maps.event.addListener(marker, 'mouseover', function() {
                    infowindow.open(map, marker);
                });
                
                // ë§ˆìš°ìŠ¤ì•„ì›ƒ ì´ë²¤íŠ¸
                kakao.maps.event.addListener(marker, 'mouseout', function() {
                    infowindow.close();
                });
            });
            
            console.log('ëª¨ë“  ë§ˆì»¤ ìƒì„± ì™„ë£Œ, ì´', reports.length, 'ê°œ');
            console.log('ì§€ë„ ì¤‘ì‹¬ ìœ ì§€ë¨ - ì¶©ë‚¨ëŒ€í•™êµ ì¤‘ì‹¬');
        };
    </script>
</body>
</html>
