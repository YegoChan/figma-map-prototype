<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¶©ë‚¨ëŒ€í•™êµ ìœ„ì¹˜ ì„ íƒ</title>
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=46de823e6fff11047613229fe0d8049f"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body, html {
            width: 100%;
            height: 100%;
            overflow: hidden;
        }
        #map {
            width: 100%;
            height: 100%;
        }
        .info-box {
            position: absolute;
            top: 10px;
            left: 10px;
            background: white;
            padding: 10px 15px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            z-index: 10;
        }
        .info-box p {
            margin: 0;
            font-size: 13px;
            font-weight: 500;
            color: #333;
        }
    </style>
</head>
<body>
    <div class="info-box">
        <p>ğŸ“ ì§€ë„ë¥¼ í´ë¦­í•˜ì—¬ ìœ„ì¹˜ë¥¼ ì„ íƒí•˜ì„¸ìš”</p>
    </div>
    <div id="map"></div>

    <script>
        console.log('ìœ„ì¹˜ ì„ íƒ ì§€ë„ ì‹œì‘');
        
        let selectedMarker = null;

        // ì§€ë„ ìƒì„±
        window.onload = function() {
            console.log('window.onload ì‹¤í–‰');
            
            if (typeof kakao === 'undefined' || !kakao.maps) {
                console.error('ì¹´ì¹´ì˜¤ë§µ APIê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤');
                return;
            }

            const container = document.getElementById('map');
            // ì¶©ë‚¨ëŒ€í•™êµ ì¤‘ì‹¬ ì¢Œí‘œ
            const cnuCenter = new kakao.maps.LatLng(36.3684, 127.3448);
            
            const options = {
                center: cnuCenter,
                level: 3
            };
            
            const map = new kakao.maps.Map(container, options);
            console.log('ì§€ë„ ìƒì„± ì™„ë£Œ');
            
            // ì»¨íŠ¸ë¡¤ ì¶”ê°€
            const mapTypeControl = new kakao.maps.MapTypeControl();
            map.addControl(mapTypeControl, kakao.maps.ControlPosition.TOPRIGHT);
            
            const zoomControl = new kakao.maps.ZoomControl();
            map.addControl(zoomControl, kakao.maps.ControlPosition.RIGHT);

            // ì§€ë„ í´ë¦­ ì´ë²¤íŠ¸
            kakao.maps.event.addListener(map, 'click', function(mouseEvent) {
                const latlng = mouseEvent.latLng;
                const lat = latlng.getLat();
                const lng = latlng.getLng();
                
                console.log('í´ë¦­ ìœ„ì¹˜:', lat, lng);
                
                // ê¸°ì¡´ ë§ˆì»¤ ì œê±°
                if (selectedMarker) {
                    selectedMarker.setMap(null);
                }
                
                // ë§ˆì»¤ ì´ë¯¸ì§€ ìƒì„±
                const svgColor = '#2563eb';
                const size = 40;
                const svg = `
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="${size}" height="${size}">
                        <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z" fill="${svgColor}" stroke="white" stroke-width="2"/>
                        <circle cx="12" cy="10" r="3" fill="white"/>
                    </svg>
                `;
                const encoded = encodeURIComponent(svg);
                const imageSrc = `data:image/svg+xml,${encoded}`;
                const imageSize = new kakao.maps.Size(size, size);
                const imageOption = { offset: new kakao.maps.Point(size / 2, size) };
                const markerImage = new kakao.maps.MarkerImage(imageSrc, imageSize, imageOption);
                
                // ìƒˆ ë§ˆì»¤ ìƒì„±
                selectedMarker = new kakao.maps.Marker({
                    position: latlng,
                    image: markerImage,
                    map: map
                });
                
                console.log('ë§ˆì»¤ ìƒì„± ì™„ë£Œ');
                
                // ë¶€ëª¨ ì°½ìœ¼ë¡œ ì¢Œí‘œ ì „ë‹¬
                // ìœ„ê²½ë„ë¥¼ 0-100 ë²”ìœ„ì˜ x, yë¡œ ë³€í™˜
                const baseLatLng = { lat: 36.3684, lng: 127.3448 };
                const x = ((lng - baseLatLng.lng) / 0.003) * 50 + 50;
                const y = ((lat - baseLatLng.lat) / 0.003) * 50 + 50;
                
                // ë²”ìœ„ ì œí•œ
                const clampedX = Math.max(0, Math.min(100, x));
                const clampedY = Math.max(0, Math.min(100, y));
                
                console.log('ë³€í™˜ëœ ì¢Œí‘œ:', clampedX, clampedY);
                
                // postMessageë¡œ ë¶€ëª¨ì—ê²Œ ì „ë‹¬
                window.parent.postMessage({
                    type: 'LOCATION_SELECTED',
                    position: {
                        x: clampedX,
                        y: clampedY,
                        lat: lat,
                        lng: lng
                    }
                }, '*');
            });
            
            console.log('ì§€ë„ í´ë¦­ ì´ë²¤íŠ¸ ë“±ë¡ ì™„ë£Œ');
        };

        // ë¶€ëª¨ë¡œë¶€í„° ë©”ì‹œì§€ ë°›ê¸° (ì´ˆê¸° ìœ„ì¹˜ ì„¤ì • ë“±)
        window.addEventListener('message', function(event) {
            if (event.data.type === 'SET_POSITION' && event.data.position) {
                console.log('ë¶€ëª¨ë¡œë¶€í„° ìœ„ì¹˜ ì„¤ì • ìš”ì²­:', event.data.position);
                
                // position {x, y}ë¥¼ ìœ„ê²½ë„ë¡œ ë³€í™˜
                const baseLatLng = { lat: 36.3684, lng: 127.3448 };
                const lat = baseLatLng.lat + (event.data.position.y - 50) * 0.003 / 50;
                const lng = baseLatLng.lng + (event.data.position.x - 50) * 0.003 / 50;
                
                // ë§ˆì»¤ ìƒì„± ë¡œì§ (ìœ„ì™€ ë™ì¼)
                // ... (í•„ìš”ì‹œ êµ¬í˜„)
            }
        });
    </script>
</body>
</html>
